<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <title>Reimbursement Form</title>
</head>
<body>
    <div class="container">
      <h1>Reimbursement Request Form </h1>
    <div id="addForm">
        <div class="form-group row">
            <label for="location" class="col-sm-2 col-form-label">Location</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="location" placeholder="Location">
            </div>
          </div>
    
          <div class="form-group row">
            <label for="description" class="col-sm-2 col-form-label">Description</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="description" placeholder="Description">
            </div>
          </div>
    
          <div class="form-group row">
            <label for="cost" class="col-sm-2 col-form-label">Cost</label>
            <div class="col-sm-10">
              <input type="number" class="form-control" id="cost" placeholder="Cost">
            </div>
          </div>

          <div class="form-group row">
            <label for="eventType" class="col-sm-2 col-form-label">Event Type</label>
            <div class="col-sm-10">
                <select class="custom-select my-1 mr-sm-2" id="eventType">
                    <option selected>Event Type</option>
                    <option value="UniversityCourses">University Courses</option>
                    <option value="Seminars">Seminars</option>
                    <option value="CertificationPrep">Certification Preparation Classes</option>
                    <option value="Certification">Certification</option>
                    <option value="TechnicalTraining">Technical Training</option>
                    <option value="Other">Other</option>
                  </select>
            </div>
          </div>

          <div class="form-group row">
            <label for="gradingType" class="col-sm-2 col-form-label">Grading Type</label>
            <div class="col-sm-10">
                <select class="custom-select my-1 mr-sm-2" id="gradingType">
                    <option selected>Grading Type</option>
                    <option value="Pass/Fail">Pass/Fail</option>
                    <option value="Grade">Grade</option>
                    <option value="Presentation">Presentation</option>
                  </select>
            </div>
          </div>

          <div class="form-group row">
            <label for="attachment" class="col-sm-2 col-form-label">Attachments</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="attachment" placeholder="Attachments">
            </div>
          </div>

          <div class="form-group row">
            <label for="startTime" class="col-sm-2 col-form-label">Event Start Date</label>
            <div class="col-sm-10">
              <input type="date" class="form-control" id="startTime" placeholder="">
            </div>
          </div>

          <div class="form-group row">
            <label for="endTime" class="col-sm-2 col-form-label">Event End Date</label>
            <div class="col-sm-10">
              <input type="date" class="form-control" id="endTime" placeholder="">
            </div>
          </div>
    
          <div class="col-auto my-1">
            
            <button id="sendForm" onclick="addForm()" type="button" class="btn btn-primary">Submit</button>
          </div>
          
    
          <p id="success"></p>

          
    
        </div>

        <br><br>
          <a id="see-requests" href="Request.html"> 
            <button type="button" class="btn btn-primary">View Request</button>
        </a> 

    </div>
    
</body>

<script>

    var firstFormAdded = false;

    function addForm() {
        let location = document.getElementById("location").value;
        let description = document.getElementById("description").value;
        let cost = document.getElementById("cost").value;
        let gradingType = document.getElementById("gradingType").value;
        let eventType = document.getElementById("eventType").value;
        let attachment = document.getElementById("attachment").value;
        let startTime = document.getElementById("startTime").valueAsNumber;
        let endTime = document.getElementById("endTime").valueAsNumber;

        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                if (JSON.parse(this.responseText)) {
                    let content = document.getElementById("success").value
                    console.log(content)
                    if (firstFormAdded) {
                      document.getElementById("success").innerHTML = "Another Request was successfully Added"
                    } else {
                      document.getElementById("success").innerHTML = "A Request was successfuly Added"
                    }
                } else {
                    document.getElementById("success").innerHTML = "Form was NOT Added to DB"

                }

                firstFormAdded = true;
            }
        }

        let url = "http://localhost:7000/employees/requests/form"
        xhttp.open("POST", url, true)

        xhttp.setRequestHeader('Content-Type', "application/json");
        // let currentTime = new Date()
        let timeOff = (endTime - startTime);
        // these variables need to be the same as the Java Model
        let form = {
            location: location,
            description: description,
            cost: cost,
            eventType: eventType,
            supplementInfo: attachment,
            gradingType: gradingType,
            timeOff: timeOff,
            startDate: startTime
        }

        // The optional argument in the send() method allows us to provide a body for our request
        xhttp.send(JSON.stringify(form));


    }
</script>
</html>